<Page
    x:Class="FufuLauncher.Views.OtherPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:FufuLauncher.Helpers"
    mc:Ignorable="d"
    Background="Transparent">

    <Page.Resources>
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

        <Style x:Key="SettingsCardStyle" TargetType="Grid">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,0"/>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
            <Setter Property="Margin" Value="4,0,0,8"/>
        </Style>
    </Page.Resources>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="36,24,36,48" 
                        Spacing="24" 
                        MaxWidth="1000" 
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top">

                <StackPanel Spacing="4" Margin="0,0,0,12">
                    <TextBlock Text="其他设置" Style="{StaticResource TitleTextBlockStyle}"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="外部程序" Style="{StaticResource SectionHeaderStyle}"/>
                    
                    <Grid Style="{StaticResource SettingsCardStyle}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Glyph="&#xE74C;" FontSize="20" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" Margin="0,0,16,0"/>
                            
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="附加程序启动" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                <TextBlock Text="随游戏自动启动指定的 .exe 程序" Style="{StaticResource CaptionTextBlockStyle}" Opacity="0.6"/>
                            </StackPanel>
                            
                            <ToggleSwitch Grid.Column="2" IsOn="{x:Bind ViewModel.IsAdditionalProgramEnabled, Mode=TwoWay}" Margin="0"/>
                        </Grid>

                        <MenuFlyoutSeparator Grid.Row="1" Margin="-24,16,-24,16"/>

                        <ContentControl Grid.Row="2" 
                                        IsEnabled="{x:Bind ViewModel.IsAdditionalProgramEnabled, Mode=OneWay}"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Grid.Column="0"
                                             Header="程序路径"
                                             PlaceholderText="例如：C:\Tools\MapTool.exe"
                                             Text="{x:Bind ViewModel.AdditionalProgramPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             LostFocus="TextBox_LostFocus"
                                             KeyDown="ProgramPath_KeyDown"/>

                                    <Button Grid.Column="1" 
                                            Content="浏览"
                                            Command="{x:Bind ViewModel.BrowseProgramCommand}"
                                            VerticalAlignment="Bottom"
                                            Margin="0,0,0,0"/>

                                    <Button Grid.Column="2" 
                                            Style="{StaticResource AccentButtonStyle}"
                                            Command="{x:Bind ViewModel.ApplyProgramPathCommand}"
                                            IsEnabled="{x:Bind ViewModel.IsApplyButtonEnabled, Mode=OneWay}"
                                            VerticalAlignment="Bottom"
                                            Content="应用"/>
                                </Grid>

                                <TextBlock Grid.Row="1" Margin="0,8,0,0" FontSize="12" Opacity="0.6"
                                           Text="提示：如果选择路径后无反应，请手动粘贴路径并点击应用。"/>
                            </Grid>
                        </ContentControl>
                    </Grid>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="辅助功能" Style="{StaticResource SectionHeaderStyle}"/>

                    <Grid Style="{StaticResource SettingsCardStyle}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Glyph="&#xE92E;" FontSize="20" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" Margin="0,0,16,0"/>

                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="键盘连点器" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                <TextBlock Text="长按触发键以模拟高频点击" Style="{StaticResource CaptionTextBlockStyle}" Opacity="0.6"/>
                            </StackPanel>

                            <ToggleSwitch Grid.Column="2" IsOn="{x:Bind ViewModel.IsAutoClickerEnabled, Mode=TwoWay}" Margin="0"/>
                        </Grid>

                        <MenuFlyoutSeparator Grid.Row="1" Margin="-24,16,-24,16"/>

                        <ContentControl Grid.Row="2" 
                                        IsEnabled="{x:Bind ViewModel.IsAutoClickerEnabled, Mode=OneWay}"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch">
                            <Grid ColumnSpacing="32" RowSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Column="0" ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Header="触发键 (按住此键)"
                                             Text="{x:Bind ViewModel.TriggerKey, Mode=TwoWay}" 
                                             IsReadOnly="True" 
                                             PlaceholderText="无"
                                             VerticalAlignment="Bottom"/>
                                             
                                    <Button Grid.Column="1"
                                            Content="&#xE765;" FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                            ToolTipService.ToolTip="点击录制"
                                            Command="{x:Bind ViewModel.RecordTriggerKeyCommand}"
                                            VerticalAlignment="Bottom"/>
                                </Grid>

                                <Grid Grid.Column="1" ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Header="连点键 (目标按键)"
                                             Text="{x:Bind ViewModel.ClickKey, Mode=TwoWay}" 
                                             IsReadOnly="True" 
                                             PlaceholderText="无"
                                             VerticalAlignment="Bottom"/>
                                             
                                    <Button Grid.Column="1" 
                                            Content="&#xE765;" FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                            ToolTipService.ToolTip="点击录制"
                                            Command="{x:Bind ViewModel.RecordClickKeyCommand}"
                                            VerticalAlignment="Bottom"/>
                                </Grid>
                                
                                <InfoBar Grid.Row="1" Grid.ColumnSpan="2"
                                         Severity="Informational"
                                         IsClosable="False"
                                         IsOpen="True"
                                         Title="使用说明"
                                         Message="点击右侧图标进行录制，然后按下键盘上任意键。设置完成后，切换到游戏窗口依然生效。"/>
                            </Grid>
                        </ContentControl>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="12" HorizontalAlignment="Right" Margin="0,12,0,0">
                    <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                               Foreground="{ThemeResource SystemFillColorCautionBrush}"
                               HorizontalAlignment="Right"
                               TextWrapping="Wrap"
                               Visibility="{x:Bind ViewModel.StatusMessage, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}"/>
                    
                    <Button Command="{x:Bind ViewModel.SaveSettingsCommand}" 
                            Style="{StaticResource AccentButtonStyle}"
                            Padding="32,10">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                            <TextBlock Text="保存配置"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>