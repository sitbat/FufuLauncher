<Page
    x:Class="FufuLauncher.Views.AccountPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:FufuLauncher.Helpers"
    mc:Ignorable="d"
    Background="Transparent">

    <Page.Resources>
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <helpers:BoolNegationConverter x:Key="BoolNegationConverter"/>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <helpers:DictionarySafeConverter x:Key="DictionarySafeConverter"/>
    </Page.Resources>

    <ScrollViewer>
        <Grid Margin="32" HorizontalAlignment="Left">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Text="米游社账户" FontSize="24" FontWeight="Bold" 
                       Margin="0,0,0,24" HorizontalAlignment="Left"/>

            <Grid Grid.Row="1" HorizontalAlignment="Left">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Margin="0,0,0,16" HorizontalAlignment="Left">
                    <StackPanel Visibility="{x:Bind ViewModel.CurrentAccount, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}" 
                                Orientation="Horizontal" Spacing="16" HorizontalAlignment="Left">
                        <Border Width="64" Height="64" CornerRadius="32" BorderThickness="1" 
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                            <Image Source="{x:Bind ViewModel.CurrentAccount.AvatarUrl, Mode=OneWay}" 
                                   Stretch="UniformToFill"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center" Spacing="4" HorizontalAlignment="Left">
                            <TextBlock Text="{x:Bind ViewModel.CurrentAccount.Nickname, Mode=OneWay}" 
                                       FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Left"/>
                            <TextBlock Text="{x:Bind ViewModel.CurrentAccount.GameUid, Mode=OneWay}" 
                                       FontSize="13" HorizontalAlignment="Left"/>
                            <TextBlock Text="{x:Bind ViewModel.CurrentAccount.Server, Mode=OneWay}" 
                                       FontSize="11" HorizontalAlignment="Left"/>
                            <TextBlock HorizontalAlignment="Left" Margin="0,2,0,0">
                                <Run Text="等级: " FontSize="11"/>
                                <Run Text="{x:Bind ViewModel.CurrentAccount.Level, Mode=OneWay}" FontSize="11" FontWeight="Medium"/>
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,0,0,16" HorizontalAlignment="Left">
                    <Button Command="{x:Bind ViewModel.LoginCommand}" 
                            Padding="16,8" CornerRadius="6"
                            Style="{StaticResource AccentButtonStyle}">
                        <TextBlock Text="{x:Bind ViewModel.LoginButtonText, Mode=OneWay}"/>
                    </Button>

                    <Button Command="{x:Bind ViewModel.LoadUserInfoCommand}" 
                            Padding="16,8" CornerRadius="6"
                            IsEnabled="{x:Bind ViewModel.IsLoadingUserInfo, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}">
                        <Grid>
                            <TextBlock Text="刷新信息" 
                                      Visibility="{x:Bind ViewModel.IsLoadingUserInfo, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}"/>
                            <ProgressRing Width="16" Height="16" 
                                         IsActive="{x:Bind ViewModel.IsLoadingUserInfo, Mode=OneWay}"
                                         Visibility="{x:Bind ViewModel.IsLoadingUserInfo, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </Grid>
                    </Button>

                    <Button Command="{x:Bind ViewModel.LogoutCommand}" 
                            Padding="16,8" CornerRadius="6"
                            Visibility="{x:Bind ViewModel.CurrentAccount, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="退出登录"/>
                    </Button>
                    
                    <Button Command="{x:Bind ViewModel.OpenGenshinDataCommand}" 
                            Padding="16,8" CornerRadius="6"
                            Visibility="{x:Bind ViewModel.CurrentAccount, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xEB9E;" FontSize="16"/>
                                <TextBlock Text="旅行札记" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>

                <TextBlock Grid.Row="2" Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                           FontSize="12" TextWrapping="Wrap" Margin="0,0,0,16" 
                           HorizontalAlignment="Left"/>
            </Grid>

            <Grid Grid.Row="2" HorizontalAlignment="Left" 
                  Visibility="{x:Bind ViewModel.GameRolesInfo, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="{ThemeResource CardBackgroundFillColorDefault}" 
                        CornerRadius="8" Padding="16" Margin="0,0,0,16" HorizontalAlignment="Left">
                    <StackPanel Spacing="12" HorizontalAlignment="Left">
                        <TextBlock Text="游戏角色" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Left"/>
                        <ListView ItemsSource="{x:Bind ViewModel.GameRolesInfo.data.list, Mode=OneWay}" 
                                  SelectionMode="None" IsItemClickEnabled="False"
                                  HorizontalAlignment="Left">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8" HorizontalAlignment="Left">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="1" Spacing="2" HorizontalAlignment="Left">
                                            <TextBlock Text="{Binding nickname}" FontSize="14" FontWeight="Medium" 
                                                       HorizontalAlignment="Left"/>
                                            <TextBlock Text="{Binding region_name}" FontSize="12" HorizontalAlignment="Left"/>
                                            <TextBlock Text="{Binding game_uid}" FontSize="11" HorizontalAlignment="Left"/>
                                            <TextBlock HorizontalAlignment="Left" Margin="0,2,0,0">
                                                <Run Text="等级: " FontSize="11"/>
                                                <Run Text="{Binding level}" FontSize="11" FontWeight="Medium"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" Background="{ThemeResource CardBackgroundFillColorDefault}" 
                        CornerRadius="8" Padding="16" Margin="0,0,0,16" HorizontalAlignment="Left"
                        Visibility="{x:Bind ViewModel.UserFullInfo, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel Spacing="12" HorizontalAlignment="Left">
                        <TextBlock Text="社区信息" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Left"/>
                        <StackPanel Orientation="Horizontal" Spacing="24" HorizontalAlignment="Left">
                            <StackPanel HorizontalAlignment="Left">
                                <TextBlock Text="发帖数" FontSize="11" HorizontalAlignment="Left"/>
                                <TextBlock FontSize="14" FontWeight="Medium" HorizontalAlignment="Left">
                                    <Run Text="{Binding Converter={StaticResource DictionarySafeConverter}, ConverterParameter=post_num}"/>
                                </TextBlock>
                            </StackPanel>
                            <StackPanel HorizontalAlignment="Left">
                                <TextBlock Text="回复数" FontSize="11" HorizontalAlignment="Left"/>
                                <TextBlock FontSize="14" FontWeight="Medium" HorizontalAlignment="Left">
                                    <Run Text="{Binding Converter={StaticResource DictionarySafeConverter}, ConverterParameter=replypost_num}"/>
                                </TextBlock>
                            </StackPanel>
                            <StackPanel HorizontalAlignment="Left">
                                <TextBlock Text="获赞数" FontSize="11" HorizontalAlignment="Left"/>
                                <TextBlock FontSize="14" FontWeight="Medium" HorizontalAlignment="Left">
                                    <Run Text="{Binding Converter={StaticResource DictionarySafeConverter}, ConverterParameter=like_num}"/>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>