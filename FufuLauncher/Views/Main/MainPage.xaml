<Page
    x:Class="FufuLauncher.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:helpers="using:FufuLauncher.Helpers"
    x:Name="MainPageRoot"
    Background="Transparent"
    Loaded="Page_Loaded">

    <Page.Resources>
        
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <XamlControlsResources xmlns="using:Microsoft.UI.Xaml.Controls" />
            </ResourceDictionary.MergedDictionaries>

            <ResourceDictionary.ThemeDictionaries>
                <ResourceDictionary x:Key="Light">
                    <SolidColorBrush x:Key="CustomPanelBackgroundBrush" 
                                     Color="{ThemeResource CardBackgroundFillColorDefault}"/>
                    
                    <AcrylicBrush x:Key="IosGlassBrush" 
                                  TintColor="#FFFFFF" 
                                  TintOpacity="0.1" 
                                  FallbackColor="#E6FFFFFF"/>
                </ResourceDictionary>

                <ResourceDictionary x:Key="Default">
                    <SolidColorBrush x:Key="CustomPanelBackgroundBrush" 
                                     Color="#D9101010"/>
                    
                    <AcrylicBrush x:Key="IosGlassBrush" 
                                  TintColor="#000000" 
                                  TintOpacity="0.15" 
                                  FallbackColor="#E6101010"/>
                </ResourceDictionary>
            </ResourceDictionary.ThemeDictionaries>

            <helpers:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
            <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <helpers:BoolToGlyphConverter x:Key="BoolToGlyphConverter"/>
            
            <DataTemplate x:Key="NewsItemTemplate">
                <Button Background="Transparent" BorderThickness="0" Padding="8,2" Margin="0,1"
                        HorizontalAlignment="Stretch" 
                        HorizontalContentAlignment="Left" CornerRadius="4"
                        Command="{Binding ElementName=MainPageRoot, Path=OpenLinkCommand}"
                        CommandParameter="{Binding Link}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="{Binding Title}" FontSize="13" 
                                   TextTrimming="CharacterEllipsis" MaxLines="1" Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="1" Text="{Binding Date}" FontSize="12" Opacity="0.5" 
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Button>
            </DataTemplate>
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Grid>
            <!-- Removed home-page background rendering (global background is handled by MainWindow). -->

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="360"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
              
                <StackPanel Grid.Column="0" 
                            Margin="24,0,0,32"
                            VerticalAlignment="Bottom"
                            Spacing="12">
                
                    <Grid CornerRadius="12"
                          BorderThickness="1"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          Background="{StaticResource IosGlassBrush}"
                          Height="310"> 
                        <Grid.RowDefinitions>
                            <RowDefinition Height="135"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Margin="0" CornerRadius="12,12,0,0" Background="#20000000">
                            <FlipView ItemsSource="{x:Bind ViewModel.Banners, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.CurrentBanner, Mode=TwoWay}">
                                <FlipView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Image Source="{Binding Image.Url}" Stretch="UniformToFill" 
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            <Button Background="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                                    Command="{Binding ElementName=MainPageRoot, Path=OpenLinkCommand}"
                                                    CommandParameter="{Binding Image.Link}"/>
                                        </Grid>
                                    </DataTemplate>
                                </FlipView.ItemTemplate>
                            </FlipView>
                        </Grid>

                        <Pivot Grid.Row="1" Margin="2,0,2,2">
                            <Pivot.Resources>
                                <Style TargetType="PivotHeaderItem">
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="Padding" Value="12,0"/>
                                    <Setter Property="MinHeight" Value="32"/>
                                </Style>
                            </Pivot.Resources>

                            <PivotItem Header="活动">
                                <ListView ItemsSource="{x:Bind ViewModel.ActivityPosts}"
                                          ItemTemplate="{StaticResource NewsItemTemplate}"
                                          SelectionMode="None"
                                          Padding="4,0,4,4">
                                </ListView>
                            </PivotItem>

                            <PivotItem Header="公告">
                                <ListView ItemsSource="{x:Bind ViewModel.AnnouncementPosts}"
                                          ItemTemplate="{StaticResource NewsItemTemplate}"
                                          SelectionMode="None"
                                          Padding="4,0,4,4">
                                </ListView>
                            </PivotItem>

                            <PivotItem Header="资讯">
                                <ListView ItemsSource="{x:Bind ViewModel.InfoPosts}"
                                          ItemTemplate="{StaticResource NewsItemTemplate}"
                                          SelectionMode="None"
                                          Padding="4,0,4,4">
                                </ListView>
                            </PivotItem>
                        </Pivot>
                    </Grid>
                    
                    <Grid Padding="16" CornerRadius="8" 
                          BorderThickness="1" 
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          Background="{StaticResource IosGlassBrush}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="原神签到" FontSize="15" FontWeight="SemiBold" 
                                   Margin="0,0,0,8" Opacity="0.9"/>
                        <StackPanel Grid.Row="1" Spacing="2" Margin="0,0,0,12">
                            <TextBlock Text="{x:Bind ViewModel.CheckinStatusText, Mode=OneWay}" FontSize="13" TextWrapping="Wrap"/>
                            <TextBlock Text="{x:Bind ViewModel.CheckinSummary, Mode=OneWay}" FontSize="11" 
                                       Opacity="0.6" TextWrapping="Wrap"/>
                        </StackPanel>
                        <Button Grid.Row="2" Content="{x:Bind ViewModel.CheckinButtonText, Mode=OneWay}"
                                Command="{x:Bind ViewModel.ExecuteCheckinCommand}"
                                IsEnabled="{x:Bind ViewModel.IsCheckinButtonEnabled, Mode=OneWay}"
                                HorizontalAlignment="Stretch" CornerRadius="4" Padding="12,6"
                                Style="{StaticResource AccentButtonStyle}"/>
                    </Grid>
                </StackPanel>
                <TextBlock Grid.Column="0"
                           Text="© 2026 FufuLauncher Development Team. All Rights Reserved."
                           FontSize="10"
                           Opacity="0.05"
                           VerticalAlignment="Bottom"
                           HorizontalAlignment="Left"
                           Margin="30,0,0,10"
                           PointerEntered="Copyright_PointerEntered"
                           PointerExited="Copyright_PointerExited"
                           x:Name="CopyrightText"
                           IsHitTestVisible="True"/>
                
                <Grid Grid.Column="1" Margin="32" Background="Transparent">
                </Grid>

                <Button Grid.Row="1" Grid.Column="1"
                        Command="{x:Bind ViewModel.OpenScreenshotFolderCommand}"
                        IsEnabled="{x:Bind ViewModel.IsLaunchButtonEnabled, Mode=OneWay}"
                        HorizontalAlignment="Right" VerticalAlignment="Bottom"
                        Margin="0,0,280,32" CornerRadius="24" Padding="0"
                        Background="Transparent"
                        BorderThickness="0"
                        PointerEntered="ScreenshotButton_PointerEntered"
                        PointerExited="ScreenshotButton_PointerExited">
  
                    <Grid>
                        <Border x:Name="ScreenshotBlurBorder"
                                Background="{StaticResource IosGlassBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="24"
                                Opacity="1.0">
                        </Border>

                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="18,12">
                            <FontIcon Glyph="&#xE8B7;" FontSize="16"/>
                            <TextBlock Text="截图文件夹" FontSize="14" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Grid>
                </Button>
                
                <Button Grid.Row="1" Grid.Column="1"
                        Command="{x:Bind ViewModel.LaunchGameCommand}"
                        IsEnabled="{x:Bind ViewModel.IsLaunchButtonEnabled, Mode=OneWay}"
                        HorizontalAlignment="Right" VerticalAlignment="Bottom"
                        Margin="0,0,32,32" 
                        Padding="0"
                        Background="Transparent"
                        BorderThickness="0"
                        CornerRadius="24"
                        Translation="0,0,32">
                     
                    <Button.Shadow>
                        <ThemeShadow /> 
                    </Button.Shadow>
                    
                    <Grid>
                        <Border Background="{StaticResource IosGlassBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="24"/>

                        <Border CornerRadius="24">
                            <Border.Background>
                                <SolidColorBrush Color="#0078D7" Opacity="0.4"/>
                            </Border.Background>
                        </Border>

                        <StackPanel Orientation="Horizontal" Spacing="12" Padding="36,18">
                            <ProgressRing Width="20" Height="20"
                                          IsActive="{x:Bind ViewModel.IsGameLaunching, Mode=OneWay}"
                                          Visibility="{x:Bind ViewModel.IsGameLaunching, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
            
                            <FontIcon Glyph="{x:Bind ViewModel.LaunchButtonIcon, Mode=OneWay}" FontSize="20"/>
            
                            <TextBlock Text="{x:Bind ViewModel.LaunchButtonText, Mode=OneWay}"
                                       FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Button>
            </Grid>
        </Grid>
    </Grid>
</Page>