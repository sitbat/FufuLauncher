<Page x:Class="FufuLauncher.Views.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:helpers="using:FufuLauncher.Helpers">

    <Page.Resources>
        <ResourceDictionary>
            <helpers:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
            <helpers:EnumToIntConverter x:Key="EnumToIntConverter"/>
            <helpers:LanguageEnumToBooleanConverter x:Key="LanguageEnumToBooleanConverter"/>
            <helpers:WindowModeEnumToBooleanConverter x:Key="WindowModeEnumToBooleanConverter"/>
            <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            
            <Style x:Key="PresetButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
                <Setter Property="Foreground" Value="{ThemeResource TextFillColorPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="CornerRadius" Value="6"/>
            </Style>
            
            <Style x:Key="SettingsCardStyle" TargetType="Border">
                <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
                <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="20"/>
                <Setter Property="Margin" Value="0,0,0,16"/>
            </Style>
            
            <Style x:Key="SettingItemStyle" TargetType="StackPanel">
                <Setter Property="Spacing" Value="8"/>
                <Setter Property="Margin" Value="0,12,0,0"/>
            </Style>
        </ResourceDictionary>
    </Page.Resources>

    <Grid Margin="32,32,32,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <TextBlock Text="设置"
                   Style="{ThemeResource TitleTextBlockStyle}"
                   Grid.Row="0"
                   Margin="0,0,0,24"/>
        
        <ScrollViewer Grid.Row="1" 
                      Padding="0,0,12,24"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="0">
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="外观与个性化" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <TextBlock Text="应用主题" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   FontSize="14"/>
                        <TextBlock Text="选择应用程序的显示主题"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.7"
                                   Margin="0,2,0,12"/>
                        
                        <StackPanel Style="{StaticResource SettingItemStyle}">
                            <RadioButton Content="浅色模式" 
                                         FontSize="14"
                                         GroupName="AppTheme"
                                         Command="{x:Bind ViewModel.SwitchThemeCommand}"
                                         IsChecked="{x:Bind ViewModel.ElementTheme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Light}">
                                <RadioButton.CommandParameter>
                                    <ElementTheme>Light</ElementTheme>
                                </RadioButton.CommandParameter>
                            </RadioButton>
                            <RadioButton Content="深色模式" 
                                         FontSize="14"
                                         GroupName="AppTheme"
                                         Command="{x:Bind ViewModel.SwitchThemeCommand}"
                                         IsChecked="{x:Bind ViewModel.ElementTheme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Dark}">
                                <RadioButton.CommandParameter>
                                    <ElementTheme>Dark</ElementTheme>
                                </RadioButton.CommandParameter>
                            </RadioButton>
                            <RadioButton Content="跟随系统设置" 
                                         FontSize="14"
                                         GroupName="AppTheme"
                                         Command="{x:Bind ViewModel.SwitchThemeCommand}"
                                         IsChecked="{x:Bind ViewModel.ElementTheme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Default}">
                                <RadioButton.CommandParameter>
                                    <ElementTheme>Default</ElementTheme>
                                </RadioButton.CommandParameter>
                            </RadioButton>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="语言与区域" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <TextBlock Text="应用显示语言" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   FontSize="14"/>
                        <TextBlock Text="重启应用后生效"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.7"
                                   Margin="0,2,0,12"/>
                        
                        <StackPanel Style="{StaticResource SettingItemStyle}">
                            <RadioButton Content="简体中文（推荐）" 
                                         FontSize="14"
                                         GroupName="AppLanguage"
                                         CommandParameter="1"
                                         IsChecked="{x:Bind ViewModel.SelectedLanguage, Converter={StaticResource LanguageEnumToBooleanConverter}, ConverterParameter=1}"
                                         Command="{x:Bind ViewModel.SwitchLanguageCommand}"/>
                            <RadioButton Content="使用系统默认语言" 
                                         FontSize="14"
                                         GroupName="AppLanguage"
                                         CommandParameter="0"
                                         IsChecked="{x:Bind ViewModel.SelectedLanguage, Converter={StaticResource LanguageEnumToBooleanConverter}, ConverterParameter=0}"
                                         Command="{x:Bind ViewModel.SwitchLanguageCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="游戏启动配置" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <TextBlock Text="启动窗口模式" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   FontSize="14"/>
                        <StackPanel Style="{StaticResource SettingItemStyle}" Spacing="12">
                            <RadioButton Content="普通窗口" 
                                         FontSize="14"
                                         GroupName="LaunchWindowMode"
                                         IsChecked="{x:Bind ViewModel.LaunchArgsWindowMode, Mode=TwoWay, Converter={StaticResource WindowModeEnumToBooleanConverter}, ConverterParameter=Normal}"/>
                            <RadioButton Content="弹出窗口（无边框）" 
                                         FontSize="14"
                                         GroupName="LaunchWindowMode"
                                         IsChecked="{x:Bind ViewModel.LaunchArgsWindowMode, Mode=TwoWay, Converter={StaticResource WindowModeEnumToBooleanConverter}, ConverterParameter=Popup}"/>
                        </StackPanel>
                        
                        <TextBlock Text="游戏分辨率" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   FontSize="14"
                                   Margin="0,20,0,0"/>
                        <TextBlock Text="设置游戏启动时的窗口大小"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.7"
                                   Margin="0,2,0,12"/>
                        
                        <StackPanel Style="{StaticResource SettingItemStyle}" Spacing="12">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBox Header="宽度（像素）" 
                                         Width="110"
                                         Text="{x:Bind ViewModel.LaunchArgsWidth, Mode=TwoWay}"
                                         PlaceholderText="1920"/>
                                <TextBlock Text="×" 
                                           VerticalAlignment="Bottom" 
                                           Margin="0,0,0,8" 
                                           FontSize="16"/>
                                <TextBox Header="高度（像素）" 
                                         Width="110"
                                         Text="{x:Bind ViewModel.LaunchArgsHeight, Mode=TwoWay}"
                                         PlaceholderText="1080"/>
                            </StackPanel>
                            
                            <TextBlock Text="快速预设" 
                                       Style="{ThemeResource CaptionTextBlockStyle}"
                                       Opacity="0.7"
                                       Margin="0,4,0,4"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button Content="1280×720 (HD)" 
                                        Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                        CommandParameter="1280 720"
                                        Style="{StaticResource PresetButtonStyle}"/>
                                <Button Content="1920×1080 (FHD)" 
                                        Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                        CommandParameter="1920 1080"
                                        Style="{StaticResource PresetButtonStyle}"/>
                                <Button Content="2560×1440 (QHD)" 
                                        Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                        CommandParameter="2560 1440"
                                        Style="{StaticResource PresetButtonStyle}"/>
                                <Button Content="3840×2160 (4K)" 
                                        Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                        CommandParameter="3840 2160"
                                        Style="{StaticResource PresetButtonStyle}"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <TextBlock Text="高级启动参数" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   FontSize="14"
                                   Margin="0,20,0,0"/>
                        <TextBlock Text="自定义参数将追加到启动命令后"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.7"
                                   Margin="0,2,0,8"/>

                        <StackPanel Style="{StaticResource SettingItemStyle}">
                            <TextBox Header="自定义启动参数" 
                                     Text="{x:Bind ViewModel.CustomLaunchParameters, Mode=TwoWay}"
                                     PlaceholderText="例如：-fullscreen -high"
                                     MaxWidth="500"
                                     HorizontalAlignment="Left"/>
                            <InfoBar Severity="Informational"
                                     Message="提示：参数将以空格追加到游戏启动命令后，请勿输入游戏路径"
                                     IsOpen="True"
                                     IsClosable="False"
                                     Margin="0,8,0,0"
                                     FontSize="12"/>
                        </StackPanel>
                        
                        <TextBlock Text="参数预览" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   FontSize="14"
                                   Margin="0,20,0,0"/>
                        <TextBox Text="{x:Bind ViewModel.LaunchArgsPreview, Mode=OneWay}"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 FontFamily="Consolas"
                                 FontSize="11"
                                 MinHeight="60"
                                 MaxWidth="500"
                                 HorizontalAlignment="Left"
                                 Background="{ThemeResource TextControlBackground}"
                                 Padding="12,8"/>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="背景与视觉效果" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <ToggleSwitch Header="启用自定义背景"
                                      OffContent="已禁用"
                                      OnContent="已启用"
                                      IsOn="{x:Bind ViewModel.IsBackgroundEnabled, Mode=TwoWay}"/>
                        
                        <StackPanel Margin="0,16,0,0"
                                    Visibility="{x:Bind ViewModel.IsBackgroundEnabled, Mode=OneWay}">
                            
                            <TextBlock Text="背景来源" 
                                       Style="{ThemeResource BodyStrongTextBlockStyle}"
                                       FontSize="14"
                                       Margin="0,0,0,8"/>
                            
                            <StackPanel Spacing="8">
                                <Button Content="选择自定义背景图片..."
                                        Command="{x:Bind ViewModel.SelectCustomBackgroundCommand}"
                                        HorizontalAlignment="Left"
                                        Padding="12,6"
                                        CornerRadius="6"/>
                                
                                <TextBlock Text="{x:Bind ViewModel.CustomBackgroundPath, Mode=OneWay}" 
                                           FontSize="12" 
                                           Opacity="0.7" 
                                           TextWrapping="Wrap"
                                           MaxWidth="400"
                                           Visibility="{x:Bind ViewModel.HasCustomBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Button Content="清除自定义背景" 
                                            Command="{x:Bind ViewModel.ClearCustomBackgroundCommand}"
                                            HorizontalAlignment="Left"
                                            Padding="12,6"
                                            CornerRadius="6"
                                            Visibility="{x:Bind ViewModel.HasCustomBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource AccentButtonStyle}">
                                                <Setter Property="Background" Value="{ThemeResource SystemFillColorCriticalBrush}"/>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    
                                    <Button Content="打开缓存文件夹" 
                                            Command="{x:Bind ViewModel.OpenBackgroundCacheFolderCommand}"
                                            HorizontalAlignment="Left"
                                            Padding="12,6"
                                            CornerRadius="6"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <ComboBox Header="官方背景服务器" 
                                      Margin="0,16,0,0"
                                      SelectedIndex="{x:Bind ViewModel.SelectedServer, Mode=TwoWay, Converter={StaticResource EnumToIntConverter}}"
                                      MinWidth="200">
                                <ComboBoxItem Content="国服 (天空岛)"/>
                                <ComboBoxItem Content="国际服 (提瓦特)"/>
                            </ComboBox>

                            <TextBlock Text="{x:Bind ViewModel.BackgroundCacheFolderPath, Mode=OneWay}" 
                                       FontSize="11" 
                                       Opacity="0.6" 
                                       TextWrapping="Wrap"
                                       Margin="0,12,0,0"
                                       MaxWidth="400"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="窗口效果" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <ToggleSwitch Header="启用亚克力（Acrylic）背景效果"
                                      OffContent="已禁用"
                                      OnContent="已启用"
                                      IsOn="{x:Bind ViewModel.IsAcrylicEnabled, Mode=TwoWay}"/>
                        
                        <InfoBar Severity="Warning"
                                 Message="注意：浅色模式下可能存在显示问题，建议使用深色模式或关闭此选项"
                                 IsOpen="True"
                                 IsClosable="False"
                                 Margin="0,12,0,0"/>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="启动音效" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <ToggleSwitch Header="启用游戏启动音效"
                                      OffContent="已禁用"
                                      OnContent="已启用"
                                      IsOn="{x:Bind ViewModel.IsStartupSoundEnabled, Mode=TwoWay}"/>
                        
                        <StackPanel Margin="0,16,0,0"
                                    Visibility="{x:Bind ViewModel.IsStartupSoundEnabled, Mode=OneWay}">
                            
                            <Button Content="选择音频文件..."
                                    Command="{x:Bind ViewModel.SelectStartupSoundCommand}"
                                    HorizontalAlignment="Left"
                                    Padding="12,6"
                                    CornerRadius="6"/>
                            
                            <TextBlock Text="{x:Bind ViewModel.StartupSoundPath, Mode=OneWay}" 
                                       FontSize="12" 
                                       Opacity="0.7" 
                                       TextWrapping="Wrap"
                                       MaxWidth="400"
                                       Margin="0,8,0,0"
                                       Visibility="{x:Bind ViewModel.HasCustomStartupSound, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            
                            <Button Content="清除音频文件" 
                                    Command="{x:Bind ViewModel.ClearStartupSoundCommand}"
                                    HorizontalAlignment="Left"
                                    Padding="12,6"
                                    CornerRadius="6"
                                    Margin="0,8,0,0"
                                    Visibility="{x:Bind ViewModel.HasCustomStartupSound, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource AccentButtonStyle}">
                                        <Setter Property="Background" Value="{ThemeResource SystemFillColorCriticalBrush}"/>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="高级选项" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <ToggleSwitch Header="使用短期支持版本（STS）"
                                      OffContent="标准版本（推荐）"
                                      OnContent="短期支持版本"
                                      IsOn="{x:Bind ViewModel.IsShortTermSupportEnabled, Mode=TwoWay}"/>
                        
                        <InfoBar Severity="Warning"
                                 Title="重要提示"
                                 Message="短期支持模式下无法使用控制面板功能，请使用键盘方向键控制FOV设置"
                                 IsOpen="True"
                                 IsClosable="False"
                                 Margin="0,12,0,0"/>
                        
                        <ToggleSwitch Header="启用 BetterGI 联动"
                                      OffContent="已禁用"
                                      OnContent="已启用"
                                      IsOn="{x:Bind ViewModel.IsBetterGIIntegrationEnabled, Mode=TwoWay}"
                                      Margin="0,16,0,0"/>
                        <TextBlock Text="启动游戏时的同时打开BetterGI"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.7"
                                   Margin="0,0,0,0"/>
                        <ToggleSwitch Header="退出游戏时关闭 BetterGI"
                                      OffContent="已禁用"
                                      OnContent="已启用"
                                      IsOn="{x:Bind ViewModel.IsBetterGICloseOnExitEnabled, Mode=TwoWay}"
                                      Margin="0,8,0,0"/>
                        <TextBlock Text="点击退出游戏,自动关闭BetterGI"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.7"
                                   Margin="0,0,0,0"/>
                    </StackPanel>
                </Border>
                
                <Border Style="{StaticResource SettingsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="关于" 
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   Margin="0,0,0,16"/>
                        
                        <StackPanel Spacing="4">
                            <HyperlinkButton Margin="-12,0,0,0" 
                                             NavigateUri="https://github.com/CodeCubist/FufuLauncher">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock VerticalAlignment="Center" 
                                               FontFamily="ms-appx:///Assets/Fonts/icomoon.ttf#icomoon" 
                                               FontSize="18" 
                                               Text="&#xe900;"/>
                                    <TextBlock VerticalAlignment="Center" 
                                               Text="芙芙启动器 1.0.2.2"
                                               Style="{ThemeResource BodyTextBlockStyle}"/>
                                </StackPanel>
                            </HyperlinkButton>
                            
                            <HyperlinkButton Margin="-12,0,0,0" 
                                             NavigateUri="https://github.com/CodeCubist">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock VerticalAlignment="Center" 
                                               FontFamily="ms-appx:///Assets/Fonts/icomoon.ttf#icomoon" 
                                               FontSize="18" 
                                               Text="&#xe901;"/>
                                    <TextBlock VerticalAlignment="Center" 
                                               Text="CodeCubist"
                                               Style="{ThemeResource BodyTextBlockStyle}"/>
                                </StackPanel>
                            </HyperlinkButton>

                            <HyperlinkButton Margin="-12,0,0,0" 
                                             NavigateUri="https://github.com/MarlonPullan6">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock VerticalAlignment="Center" 
                                               FontFamily="ms-appx:///Assets/Fonts/icomoon.ttf#icomoon" 
                                               FontSize="18" 
                                               Text="&#xe901;"/>
                                    <TextBlock VerticalAlignment="Center" 
                                               Text="MIANKRAM"
                                               Style="{ThemeResource BodyTextBlockStyle}"/>
                                </StackPanel>
                            </HyperlinkButton>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>