<Page x:Class="FufuLauncher.Views.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:helpers="using:FufuLauncher.Helpers">

    <Page.Resources>
        <ResourceDictionary>
            <helpers:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
            <helpers:EnumToIntConverter x:Key="EnumToIntConverter" />
            <helpers:LanguageEnumToBooleanConverter x:Key="LanguageEnumToBooleanConverter" />
            <helpers:WindowModeEnumToBooleanConverter x:Key="WindowModeEnumToBooleanConverter" />
            <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            
            <Style x:Key="PresetButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
                <Setter Property="Foreground" Value="{ThemeResource TextFillColorPrimaryBrush}" />
                <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="12,6" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Height" Value="32" />
                <Setter Property="CornerRadius" Value="6" />
            </Style>
        </ResourceDictionary>
    </Page.Resources>

    <Grid Margin="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <ScrollViewer Grid.Row="1">
            <StackPanel Spacing="20">
                
                <TextBlock Text="个性化" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,36,0,36">
                    <TextBlock Text="主题" />
                    <StackPanel Margin="0,12,0,0">
                        <RadioButton Content="浅色" FontSize="15" GroupName="AppTheme"
                                     Command="{x:Bind ViewModel.SwitchThemeCommand}"
                                     IsChecked="{x:Bind ViewModel.ElementTheme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Light}">
                            <RadioButton.CommandParameter>
                                <ElementTheme>Light</ElementTheme>
                            </RadioButton.CommandParameter>
                        </RadioButton>
                        <RadioButton Content="深色" FontSize="15" GroupName="AppTheme"
                                     Command="{x:Bind ViewModel.SwitchThemeCommand}"
                                     IsChecked="{x:Bind ViewModel.ElementTheme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Dark}">
                            <RadioButton.CommandParameter>
                                <ElementTheme>Dark</ElementTheme>
                            </RadioButton.CommandParameter>
                        </RadioButton>
                        <RadioButton Content="使用系统设置" FontSize="15" GroupName="AppTheme"
                                     Command="{x:Bind ViewModel.SwitchThemeCommand}"
                                     IsChecked="{x:Bind ViewModel.ElementTheme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Default}">
                            <RadioButton.CommandParameter>
                                <ElementTheme>Default</ElementTheme>
                            </RadioButton.CommandParameter>
                        </RadioButton>
                    </StackPanel>
                </StackPanel>

                
                <TextBlock Text="语言设置" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0">
                    <TextBlock Text="应用语言" FontSize="15" Margin="0,0,0,12"/>
                    <StackPanel>
                        <RadioButton Content="简体中文" FontSize="15" GroupName="AppLanguage"
                                     CommandParameter="1"
                                     IsChecked="{x:Bind ViewModel.SelectedLanguage, Converter={StaticResource LanguageEnumToBooleanConverter}, ConverterParameter=1}"
                                     Command="{x:Bind ViewModel.SwitchLanguageCommand}"/>
                        <RadioButton Content="系统默认" FontSize="15" GroupName="AppLanguage"
                                     CommandParameter="0"
                                     IsChecked="{x:Bind ViewModel.SelectedLanguage, Converter={StaticResource LanguageEnumToBooleanConverter}, ConverterParameter=0}"
                                     Command="{x:Bind ViewModel.SwitchLanguageCommand}"/>
                    </StackPanel>
                </StackPanel>

                
                <TextBlock Text="游戏启动" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0" Spacing="12">
                    
                    
                    <TextBlock Text="窗口模式" FontSize="15" Margin="0,0,0,8"/>
                    <StackPanel Orientation="Horizontal" Spacing="20">
                        <RadioButton Content="普通窗口" 
                                     FontSize="15" 
                                     GroupName="LaunchWindowMode"
                                     IsChecked="{x:Bind ViewModel.LaunchArgsWindowMode, Mode=TwoWay, Converter={StaticResource WindowModeEnumToBooleanConverter}, ConverterParameter=Normal}"/>
                        <RadioButton Content="弹出窗口" 
                                     FontSize="15" 
                                     GroupName="LaunchWindowMode"
                                     IsChecked="{x:Bind ViewModel.LaunchArgsWindowMode, Mode=TwoWay, Converter={StaticResource WindowModeEnumToBooleanConverter}, ConverterParameter=Popup}"/>
                    </StackPanel>

                    
                    <TextBlock Text="分辨率设置" FontSize="15" Margin="0,12,0,8"/>
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBox Header="宽度" 
                                 Width="100"
                                 Text="{x:Bind ViewModel.LaunchArgsWidth, Mode=TwoWay}"
                                 PlaceholderText="1920"/>
                        <TextBlock Text="×" 
                                   VerticalAlignment="Center" 
                                   Margin="0,20,0,0" 
                                   FontSize="16"/>
                        <TextBox Header="高度" 
                                 Width="100"
                                 Text="{x:Bind ViewModel.LaunchArgsHeight, Mode=TwoWay}"
                                 PlaceholderText="1080"/>
                    </StackPanel>
                    
                    
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="1280×720" 
                                Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                CommandParameter="1280 720"
                                Style="{StaticResource PresetButtonStyle}"/>
                        <Button Content="1920×1080" 
                                Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                CommandParameter="1920 1080"
                                Style="{StaticResource PresetButtonStyle}"/>
                        <Button Content="2560×1440" 
                                Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                CommandParameter="2560 1440"
                                Style="{StaticResource PresetButtonStyle}"/>
                        <Button Content="3840×2160" 
                                Command="{x:Bind ViewModel.SetResolutionPresetCommand}"
                                CommandParameter="3840 2160"
                                Style="{StaticResource PresetButtonStyle}"/>
                    </StackPanel>

                    
                    <TextBlock Text="启动参数预览" FontSize="15" Margin="0,12,0,8"/>
                    <TextBox Text="{x:Bind ViewModel.LaunchArgsPreview, Mode=OneWay}"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             FontFamily="Consolas"
                             MaxWidth="500"
                             FontSize="12"
                             MinHeight="60"
                             AcceptsReturn="True"
                             Background="{ThemeResource TextControlBackground}"
                             HorizontalAlignment="Left"/>
                    
                    
                    <TextBox Header="自定义参数" 
                             Text="{x:Bind ViewModel.CustomLaunchParameters, Mode=TwoWay}"
                             PlaceholderText="如需自定义参数可在此输入"
                             Margin="0,8,0,0"
                             MaxWidth="500"
                             HorizontalAlignment="Left"/>
                    <TextBlock Text="提示：参数将以空格追加到游戏启动命令后，请勿输入游戏路径" 
                               FontSize="11" 
                               Opacity="0.6" 
                               Margin="0,-8,0,0"/>
                </StackPanel>

                
                <TextBlock Text="原神启动器背景" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0" Spacing="12">
                    <ToggleSwitch Header="启用背景" IsOn="{x:Bind ViewModel.IsBackgroundEnabled, Mode=TwoWay}" />
                    
                    <StackPanel Spacing="8">
                        <Button Content="选择自定义背景文件..." 
                                Command="{x:Bind ViewModel.SelectCustomBackgroundCommand}"
                                HorizontalAlignment="Left"
                                Padding="12,6"
                                CornerRadius="6"
                                IsEnabled="{x:Bind ViewModel.IsBackgroundEnabled, Mode=OneWay}"/>
                        
                        <TextBlock Text="{x:Bind ViewModel.CustomBackgroundPath, Mode=OneWay}" 
                                   FontSize="12" Opacity="0.7" TextWrapping="Wrap"
                                   Visibility="{x:Bind ViewModel.HasCustomBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        
                        <Button Content="清除自定义背景" 
                                Command="{x:Bind ViewModel.ClearCustomBackgroundCommand}"
                                HorizontalAlignment="Left"
                                Padding="12,6"
                                CornerRadius="6"
                                Visibility="{x:Bind ViewModel.HasCustomBackground, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                IsEnabled="{x:Bind ViewModel.IsBackgroundEnabled, Mode=OneWay}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource AccentButtonStyle}">
                                    <Setter Property="Background" Value="{ThemeResource SystemFillColorCriticalBrush}"/>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button Content="查看程序缓存背景文件夹" 
                                Command="{x:Bind ViewModel.OpenBackgroundCacheFolderCommand}"
                                HorizontalAlignment="Left"
                                Padding="12,6"
                                CornerRadius="6"
                                Margin="0,8,0,0"
                                IsEnabled="{x:Bind ViewModel.IsBackgroundEnabled, Mode=OneWay}"/>
                        
                        <TextBlock Text="{x:Bind ViewModel.BackgroundCacheFolderPath, Mode=OneWay}" 
                                   FontSize="11" Opacity="0.7" TextWrapping="Wrap"
                                   Margin="0,4,0,0"/>
                    </StackPanel>

                    <ComboBox Header="官方背景服务器" Margin="0,8,0,0"
                              SelectedIndex="{x:Bind ViewModel.SelectedServer, Mode=TwoWay, Converter={StaticResource EnumToIntConverter}}"
                              IsEnabled="{x:Bind ViewModel.IsBackgroundEnabled, Mode=OneWay}">
                        <ComboBoxItem Content="国服 (天空岛)" />
                        <ComboBoxItem Content="国际服 (提瓦特)" />
                    </ComboBox>
                </StackPanel>

                
                <TextBlock Text="窗口效果" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0" Spacing="12">
                    <ToggleSwitch Header="启用亚克力效果" 
                                  IsOn="{x:Bind ViewModel.IsAcrylicEnabled, Mode=TwoWay}"
                                  OffContent="禁用"
                                  OnContent="启用"/>
                    <TextBlock Text="对于浅色模式存在问题，如需使用浅色模式，请勿关闭" 
                               FontSize="11" 
                               Opacity="0.6"/>
                </StackPanel>
                
                <TextBlock Text="启动语音" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0" Spacing="12">
                    <ToggleSwitch Header="启用启动语音" IsOn="{x:Bind ViewModel.IsStartupSoundEnabled, Mode=TwoWay}" />
    
                    <StackPanel Spacing="8">
                        <Button Content="选择语音文件..." 
                                Command="{x:Bind ViewModel.SelectStartupSoundCommand}"
                                HorizontalAlignment="Left"
                                Padding="12,6"
                                CornerRadius="6"
                                IsEnabled="{x:Bind ViewModel.IsStartupSoundEnabled, Mode=OneWay}"/>
        
                        <TextBlock Text="{x:Bind ViewModel.StartupSoundPath, Mode=OneWay}" 
                                   FontSize="12" Opacity="0.7" TextWrapping="Wrap"
                                   Visibility="{x:Bind ViewModel.HasCustomStartupSound, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
        
                        <Button Content="清除语音文件" 
                                Command="{x:Bind ViewModel.ClearStartupSoundCommand}"
                                HorizontalAlignment="Left"
                                Padding="12,6"
                                CornerRadius="6"
                                Visibility="{x:Bind ViewModel.HasCustomStartupSound, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                IsEnabled="{x:Bind ViewModel.IsStartupSoundEnabled, Mode=OneWay}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource AccentButtonStyle}">
                                    <Setter Property="Background" Value="{ThemeResource SystemFillColorCriticalBrush}"/>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </StackPanel>
                
                <TextBlock Text="注入模块" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0" Spacing="12">
                    <ToggleSwitch Header="使用短期支持版本" 
                                  IsOn="{x:Bind ViewModel.IsShortTermSupportEnabled, Mode=TwoWay}"
                                  OffContent="标准版本"
                                  OnContent="短期支持"/>
                    <TextBlock Text="切换后下次启动游戏生效" 
                               FontSize="11" 
                               Opacity="0.6"/>
                    <TextBlock Text="需要管理员权限" 
                               FontSize="11" 
                               Opacity="0.6" 
                               Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                </StackPanel>

                
                <TextBlock Text="关于" Style="{ThemeResource SubtitleTextBlockStyle}" />
                <StackPanel Margin="0,12,0,0">
                    <HyperlinkButton Margin="-12,4,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock VerticalAlignment="Center" FontFamily="ms-appx:///Assets/Fonts/icomoon.ttf#icomoon" FontSize="18" Text="&#xe900;" />
                            <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" Text="芙芙启动器 1.0.2" />
                        </StackPanel>
                    </HyperlinkButton>
                    <HyperlinkButton Margin="-12,4,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock VerticalAlignment="Center" FontFamily="ms-appx:///Assets/Fonts/icomoon.ttf#icomoon" FontSize="18" Text="&#xe901;" />
                            <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" Text="CodeCubist" />
                        </StackPanel>
                    </HyperlinkButton>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>